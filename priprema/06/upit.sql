SELECT D.INDEKS, IME, PREZIME, COUNT(*) BROJ_POLOZENIH, SUM(ESPB) BROJ_ESPB 
FROM DA.DOSIJE D JOIN DA.ISPIT I ON D.INDEKS = I.INDEKS JOIN DA.PREDMET P ON  P.ID = I.IDPREDMETA
WHERE IDPROGRAMA = 101 AND OCENA > 5 AND STATUS = 'o' AND D.INDEKS NOT IN (SELECT INDEKS FROM DA.EKSKURZIJA) 
GROUP BY D.INDEKS, IME, PREZIME 
HAVING COUNT(*) >= 12 AND SUM(ESPB) >= 120;