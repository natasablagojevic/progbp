WITH POMOCNA AS (
    SELECT      INDEKS
    FROM        DA.ISPIT
    WHERE       OCENA > 5 AND STATUS = 'o'
    GROUP BY    INDEKS
    HAVING      COUNT(*) = ?
)
SELECT  INDEKS, IME, PREZIME, SP.NAZIV, P.NAZIV, OCENA
FROM    DA.DOSIJE D JOIN DA.ISPIT I ON D.INDEKS = I.INDEKS
        JOIN DA.STUDIJSKIPROGRAM SP ON D.IDPROGRAMA = SP.ID
        JOIN DA.PREDMET P ON P.ID = I.IDPREDMETA
        JOIN POMOCNA POM ON D.INDEKS = POM.INDKES
WHERE   OCENA > 5 AND STAUTS = 'o'
ORDER BY D.INDEKS;

-- -------------------------------------------------------------

SELECT IME, PREZIME, DATDIPLOMIRANJA
FROM DA.DOSIJE
WHERE IDPROGRAMA = 202 AND POL = 'z';

-- ----------------------------------------------------

CREATE TABLE DA.UNETIPREDMETI (
    IDPREDMETA INTEGER NOT NULL,
    BROJ_POLOZENIH INTEGER NOT NULL,
    PRIMARY KEY (IDPREDMETA),
    FOREIGN KEY (IDPREDMETA) REFERENES DA.PREDMET
);

-- --------------------------------------------------------

SELECT IDPREDMETA, COUNT(*)
FROM DA.ISPIT
WHERE OCENA > 5 AND STAUS = 'o' AND IDPREDMETA NOT IN (SELECT IDPREDMETA FROM DA.UNETIPREDMETI)
GROUP BY IDPREDMETA;